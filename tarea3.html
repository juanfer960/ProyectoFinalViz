<!DOCTYPE html>
<html lang="en">
<style>

text {
  font: 10px sans-serif;
}

rect.background {
  fill: white;
}

.axis {
  shape-rendering: crispEdges;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
}

.node {
  cursor: pointer;
}
.node:hover {
  stroke: #000;
  stroke-width: 1.5px;
}
.node--leaf {
  fill: white;
}
.label {
  font: 11px "Helvetica Neue", Helvetica, Arial, sans-serif;
  text-anchor: middle;
  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
}
.label,
.node--root,
.node--leaf {
  pointer-events: none;
}

.x.axis path {  display: none; }
.legend{
    margin-bottom:76px;
    display:inline-block;
    border-collapse: collapse;
    border-spacing: 0px;
}
.legend td{
    padding:4px 5px;
    vertical-align:bottom;
}
.legendFreq, .legendPerc{
    align:right;
    width:50px;
}
.chart {
       font-family: sans-serif;
     }
.chart-footer {
       font-style: italic;
       font-size: 10pt;
       color: #bbb;
     }
</style>

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>SB Admin 2 - Dashboard</title>

  <!-- Custom fonts for this template-->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <!--link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet"-->

  <!-- Custom styles for this template-->
  <link href="css/sb-admin-2.min.css" rel="stylesheet">
<script src="https://d3js.org/d3.v3.min.js"></script>


</head>

<body id="page-top">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

      <!-- Sidebar - Brand -->
      <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
        <div class="sidebar-brand-icon rotate-n-15">
          <i class="fas fa-laugh-wink"></i>
        </div>
        <div class="sidebar-brand-text mx-3">Data Viz </sup></div>
      </a>

      <!-- Divider -->
      <hr class="sidebar-divider my-0">

      <!-- Nav Item - Dashboard -->
      <li class="nav-item active">
        <a class="nav-link" href="index.html">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Post: </span></a>
      </li>
      <hr class="sidebar-divider">
      <div class="sidebar-heading">
      tareas:
      </div>

      <li class="nav-item">
        <a class="nav-link" href="tarea1.html">
          <i class="fas fa-fw fa-chart-area"></i>
          <span>Tarea 1:</span></a>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="tarea2.html">
          <i class="fas fa-fw fa-chart-area"></i>
          <span>Tarea 2:</span></a>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="tarea3.html">
          <i class="fas fa-fw fa-chart-area"></i>
          <span>Tarea 3:</span></a>
      </li>
      <!-- Divider -->
      <hr class="sidebar-divider d-none d-md-block">

      <!-- Sidebar Toggler (Sidebar) -->
      <div class="text-center d-none d-md-inline">
        <button class="rounded-circle border-0" id="sidebarToggle"></button>
      </div>

    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

          <!-- Sidebar Toggle (Topbar) -->
          <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
            <i class="fa fa-bars"></i>
          </button>

          <!-- Topbar Navbar -->
          <ul class="navbar-nav ml-auto">

            <!-- Nav Item - Search Dropdown (Visible Only XS) -->
            <li class="nav-item dropdown no-arrow d-sm-none">
              <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-search fa-fw"></i>
              </a>
              <!-- Dropdown - Messages -->
              <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in" aria-labelledby="searchDropdown">
                <form class="form-inline mr-auto w-100 navbar-search">
                  <div class="input-group">
                    <input type="text" class="form-control bg-light border-0 small" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2">
                  </div>
                </form>
              </div>
            </li>
          </ul>

        </nav>
        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">Biodiversidad en cifras:</h1>
          </div>

          <!-- Approach -->
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">EL SIB COLOMBIA</h6>
            </div>
            <div class="card-body">
              <p>El SiB Colombia es la red nacional de datos abiertos sobre biodiversidad. Esta iniciativa de país nace con el Decreto 1603 de 1994 como parte del proceso de creación del Sistema Nacional Ambiental (Sina), establecido en la Ley 99 de 1993, y es el nodo oficial del país en la Infraestructura Mundial de Información en Biodiversidad (GBIF). Su principal propósito es brindar acceso abierto a información sobre la diversidad biológica del país para la construcción de una sociedad sostenible. Además, facilita la publicación en línea de datos e información sobre biodiversidad, y promueve su uso por parte de una amplia variedad de audiencias, apoyando de forma oportuna y eficiente la gestión integral de la biodiversidad.</p>
              <p class="mb-0">El SiB Colombia es una realidad gracias a la participación de cientos de organizaciones y personas que comparten datos e información bajo los principios de libre acceso, transparencia, cooperación, reconocimiento y responsabilidad compartida.</p>
              <p class="mb-0">Más y mejor información disponible, conectada y consolidada, que se transforma en conocimiento para conservar, aprovechar y conectarse con la biodiversidad. (tomado de: https://sibcolombia.net/el-sib-colombia/)</p>
            </div>
          </div>

          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">Acerca de las visualizaciones:</h6>
            </div>
            <div class="card-body">
              <p>Las visualizaciones presentadas a continuación toman como fuente, los datos consolidados correspondientes al registro biológico publicado a través del Sistema de información sobre Biodiversidad de Colombia – SIB Colombia, por la red de socios publicadores y los datos repartidos de GBIF, eBird, Xeno – Canto y iNaturalist. El numero de registro biológicos varia según la fecha de corte de los datos, para lo cual se realiza un consolidado de datos de forma trimestre.</p>
              <p class="mb-0">Al trimestre 2 de 2019 este repositorio cuenta con 7’386.568 registros, los cuales fueron tomados como insumo para las siguientes visualizaciones.</p>
              <p class="mb-0">Las visualizaciones de esta sección (Tarea 3) se enfocan en resumir, ordenar, mostrar mínimos y máximos de publicaciones por departamentos y municipios. (Basado en: Historico_de_datos_trimestrales.pdf - https://sibcolombia.net/el-sib-colombia/)</p>
            </div>
          </div>
        </div>
          <div class="row">
            <div class="col-lg-6 mb-4">
              <div class="card bg-primary text-white shadow">
                <div class="card-body">
                  Visualizacion uno:
                  <div class="text-white-50 small">Zoomable Circle Packing</div>
                </div>
              </div>
            </div>
          </div>
          <!-- Area Chart -->
          <div class="col-xl-12 col-lg-12" id="primera">
            <div class="card shadow mb-7">
              <!-- Card Header - Dropdown -->
              <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Resumen de publicaciones por departamento/municipios:</h6>
              </div>
              <!-- Card Body -->
              <div class="card-body">
              <!-- **************************************************************************************** -->


              <!-- Create a div where the graph will take place -->
              <div id="my_dataviz">
                <svg width="900" height="900"></svg>
                <script src="https://d3js.org/d3.v4.js"></script>
                <script>
                var svg = d3.select("svg"),
                    margin = 20,
                    diameter = +svg.attr("width"),
                    g = svg.append("g").attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");

                var color1 = d3.scaleLinear()
                    .domain([-1, 5])
                    .range(["hsl(214,77%,65%)", "hsl(188,89%,88%)"])
                    .interpolate(d3.interpolateHcl);

                var pack = d3.pack()
                    .size([diameter - margin, diameter - margin])
                    .padding(2);

                d3.json("https://raw.githubusercontent.com/juanfer960/DatosVizTarea3/master/json.txt", function(error, root) {
                  if (error) throw error;
                  root = d3.hierarchy(root)
                      .sum(function(d) { return d.size; })
                      .sort(function(a, b) { return b.value - a.value; });
                  var focus = root,
                      nodes = pack(root).descendants(),
                      view;
                  var circle = g.selectAll("circle")
                    .data(nodes)
                    .enter().append("circle")
                      .attr("class", function(d) { return d.parent ? d.children ? "node" : "node node--leaf" : "node node--root"; })
                      .style("fill", function(d) { return d.children ? color1(d.depth) : null; })
                      .on("click", function(d) { if (focus !== d) zoom(d), d3.event.stopPropagation(); });
                  var text = g.selectAll("text")
                    .data(nodes)
                    .enter().append("text")
                      .attr("class", "label")
                      .style("fill-opacity", function(d) { return d.parent === root ? 1 : 0; })
                      .style("display", function(d) { return d.parent === root ? "inline" : "none"; })
                      .text(function(d) { return d.data.name; });
                  var node = g.selectAll("circle,text");
                  svg
                      .style("background", color1(-1))
                      .on("click", function() { zoom(root); });
                  zoomTo([root.x, root.y, root.r * 2 + margin]);
                  function zoom(d) {
                    var focus0 = focus; focus = d;
                    var transition = d3.transition()
                        .duration(d3.event.altKey ? 7500 : 750)
                        .tween("zoom", function(d) {
                          var i = d3.interpolateZoom(view, [focus.x, focus.y, focus.r * 2 + margin]);
                          return function(t) { zoomTo(i(t)); };
                        });
                    transition.selectAll("text")
                      .filter(function(d) { return d.parent === focus || this.style.display === "inline"; })
                        .style("fill-opacity", function(d) { return d.parent === focus ? 1 : 0; })
                        .on("start", function(d) { if (d.parent === focus) this.style.display = "inline"; })
                        .on("end", function(d) { if (d.parent !== focus) this.style.display = "none"; });
                  }
                  function zoomTo(v) {
                    var k = diameter / v[2]; view = v;
                    node.attr("transform", function(d) { return "translate(" + (d.x - v[0]) * k + "," + (d.y - v[1]) * k + ")"; });
                    circle.attr("r", function(d) { return d.r * k; });
                  }
                });
                </script>
                  <hr>
                <!--**************************-->
                <div class="chart">
                <div id="chart"></div>
                <div class="chart-footer">
                  <strong></strong> Visualizacion basada en modismo Zoomable Circle Packing by Mike Bostock.
                  <br>
                  <strong>By:</strong> Juan Fernando Zuluaga Ramirez
                  <br>
                  <strong>Source:</strong> <a href="https://raw.githubusercontent.com/juanfer960/DatosVizTarea3/master/json.txt">github</a>
                </div>
              </div>`
                <!--************************-->
              </div>

              </div>
            </div>

          </div>

          <hr>

          <!--******************************************************************************************************************************-->


          <div class="row">
            <div class="col-lg-6 mb-4">
              <div class="card bg-primary text-white shadow">
                <div class="card-body">
                  Visualizacion dos:
                  <div class="text-white-50 small">Hierarchical Bar Chart</div>
                </div>
              </div>
            </div>
          </div>

          <!--******************************************************************************************************************************-->
          <div class="col-xl-12 col-lg-12" id="segunda">
            <div class="card shadow mb-7">
              <!-- Card Header - Dropdown -->
              <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Histograma de numero de publicaciones por departamento/municipio:</h6>
              </div>
              <!-- Card Body -->
              <div class="card-body">
              <!-- **************************************************************************************** -->


              <!-- Create a div where the graph will take place -->
              <div id="my_dataviz_1">
                <script src="https://d3js.org/d3.v4.js"></script>
                <script>
                var margin1 = {top: 30, right: 120, bottom: 0, left: 120},
                width1 = 960 - margin1.left - margin1.right,
                height1 = 4000 - margin1.top - margin1.bottom;

                var x = d3.scaleLinear()
                .range([0, width1]);

                var barHeight = 20;

                var color = d3.scaleOrdinal()
                .range(["SkyBlue", "#ccc"]);

                var duration = 750,
                delay = 25;

                var partition = d3.partition();


                var xAxis = d3.axisTop()
                .scale(x);

                var svg2 = d3.select("#my_dataviz_1").append("svg")
                .attr("width", width1 + margin1.left + margin1.right)
                .attr("height", height1 + margin1.top + margin1.bottom)
                .append("g")
                .attr("transform", "translate(" + margin1.left + "," + margin1.top + ")");

                svg2.append("rect")
                .attr("class", "background")
                .attr("width", width1)
                .attr("height", height1)
                .on("click", up);

                svg2.append("g")
                .attr("class", "x axis");

                svg2.append("g")
                .attr("class", "y axis")
                .append("line")
                .attr("y1", "100%");

                d3.json("https://raw.githubusercontent.com/juanfer960/DatosVizTarea3/master/json.txt", function(error, root) {
                if (error) throw error;
                root = d3.hierarchy(root)
                            .sum(d => d.size)
                            .sort((a,b) => b.value - a.value);

                partition(root);

                x.domain([0, root.value]).nice();
                down(root, 0);
                });

                function down(d, i) {
                if (!d.children || this.__transition__) return;
                var end = duration + d.children.length * delay;

                // Mark any currently-displayed bars as exiting.
                var exit = svg2.selectAll(".enter")
                  .attr("class", "exit");

                // Entering nodes immediately obscure the clicked-on bar, so hide it.
                exit.selectAll("rect").filter(function(p) { return p === d; })
                  .style("fill-opacity", 1e-6);

                // Enter the new bars for the clicked-on data.
                // Per above, entering bars are immediately visible.
                var enter = bar(d)
                  .attr("transform", stack(i))
                  .style("opacity", 1);

                // Have the text fade-in, even though the bars are visible.
                // Color the bars as parents; they will fade to children if appropriate.
                enter.select("text").style("fill-opacity", 1e-6);
                enter.select("rect").style("fill", color(true));

                // Update the x-scale domain.
                x.domain([0, d3.max(d.children, function(d) { return d.value; })]).nice();

                // Update the x-axis.
                svg2.selectAll(".x.axis").transition()
                  .duration(duration)
                  .call(xAxis);

                // Transition entering bars to their new position.
                var enterTransition = enter.transition()
                  .duration(duration)
                  .delay(function(d, i) { return i * delay; })
                  .attr("transform", function(d, i) { return "translate(0," + barHeight * i * 1.2 + ")"; });

                // Transition entering text.
                enterTransition.select("text")
                  .style("fill-opacity", 1);

                // Transition entering rects to the new x-scale.
                enterTransition.select("rect")
                  .attr("width", function(d) { return x(d.value); })
                  .style("fill", function(d) { return color(!!d.children); });

                // Transition exiting bars to fade out.
                var exitTransition = exit.transition()
                  .duration(duration)
                  .style("opacity", 1e-6)
                  .remove();

                // Transition exiting bars to the new x-scale.
                exitTransition.selectAll("rect")
                  .attr("width", function(d) { return x(d.value); });

                // Rebind the current node to the background.
                svg2.select(".background")
                  .datum(d)
                .transition()
                  .duration(end);

                d.index = i;
                }

                function up(d) {
                if (!d.parent || this.__transition__) return;
                var end = duration + d.children.length * delay;

                // Mark any currently-displayed bars as exiting.
                var exit = svg2.selectAll(".enter")
                  .attr("class", "exit");

                // Enter the new bars for the clicked-on data's parent.
                var enter = bar(d.parent)
                  .attr("transform", function(d, i) { return "translate(0," + barHeight * i * 1.2 + ")"; })
                  .style("opacity", 1e-6);

                // Color the bars as appropriate.
                // Exiting nodes will obscure the parent bar, so hide it.
                enter.select("rect")
                  .style("fill", function(d) { return color(!!d.children); })
                .filter(function(p) { return p === d; })
                  .style("fill-opacity", 1e-6);

                // Update the x-scale domain.
                x.domain([0, d3.max(d.parent.children, function(d) { return d.value; })]).nice();

                // Update the x-axis.
                svg2.selectAll(".x.axis").transition()
                  .duration(duration)
                  .call(xAxis);

                // Transition entering bars to fade in over the full duration.
                var enterTransition = enter.transition()
                  .duration(end)
                  .style("opacity", 1);

                // Transition entering rects to the new x-scale.
                // When the entering parent rect is done, make it visible!
                enterTransition.select("rect")
                  .attr("width", function(d) { return x(d.value); })
                  .on("end",function(p) { if (p === d) d3.select(this).style("fill-opacity", null); });

                // Transition exiting bars to the parent's position.
                var exitTransition = exit.selectAll("g").transition()
                  .duration(duration)
                  .delay(function(d, i) { return i * delay; })
                  .attr("transform", stack(d.index));

                // Transition exiting text to fade out.
                exitTransition.select("text")
                  .style("fill-opacity", 1e-6);

                // Transition exiting rects to the new scale and fade to parent color.
                exitTransition.select("rect")
                  .attr("width", function(d) { return x(d.value); })
                  .style("fill", color(true));

                // Remove exiting nodes when the last child has finished transitioning.
                exit.transition()
                  .duration(end)
                  .remove();

                // Rebind the current parent to the background.
                svg2.select(".background")
                  .datum(d.parent)
                .transition()
                  .duration(end);
                }

                // Creates a set of bars for the given data node, at the specified index.
                function bar(d) {
                var bar = svg2.insert("g", ".y.axis")
                  .attr("class", "enter")
                  .attr("transform", "translate(0,5)")
                .selectAll("g")
                  .data(d.children)
                .enter().append("g")
                  .style("cursor", function(d) { return !d.children ? null : "pointer"; })
                  .on("click", down);

                bar.append("text")
                  .attr("x", -6)
                  .attr("y", barHeight / 2)
                  .attr("dy", ".35em")
                  .style("text-anchor", "end")
                  .text(function(d) { return d.data.name; });

                bar.append("rect")
                  .attr("width", function(d) { return x(d.value); })
                  .attr("height", barHeight);

                return bar;
                }

                // A stateful closure for stacking bars horizontally.
                function stack(i) {
                var x0 = 0;
                return function(d) {
                var tx = "translate(" + x0 + "," + barHeight * i * 1.2 + ")";
                x0 += x(d.value);
                return tx;
                };
                }

                </script>
                  <hr>
                <!--**************************-->
                <div class="chart">
                <div id="chart"></div>
                <div class="chart-footer">
                  <strong></strong> Visualizacion basada en modismo Hierarchical Bar Chart by Evan Galloway.
                  <br>
                  <strong>By:</strong> Juan Fernando Zuluaga Ramirez
                  <br>
                  <strong>Source:</strong> <a href="https://raw.githubusercontent.com/juanfer960/DatosVizTarea3/master/json.txt">github</a>
                </div>
              </div>`
                <!--************************-->
              </div>
              </div>
            </div>
          </div>

    <hr>
                    <!--*******************************************************************************************************************-->
                    <div class="row">
                      <div class="col-lg-6 mb-4">
                        <div class="card bg-primary text-white shadow">
                          <div class="card-body">
                            Visualizacion Tres:
                            <div class="text-white-50 small">DashBoard: interaction between Bar Char and pie chart </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="col-xl-12 col-lg-12" id="tercera">
                      <div class="card shadow mb-7">
                        <!-- Card Header - Dropdown -->
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                          <h6 class="m-0 font-weight-bold text-primary">Top 10 de los departamentos con el municipio con mas publicaciones y la media de publicaciones por municipios dentro del top:</h6>
                        </div>
                        <!-- Card Body -->
                        <div class="card-body">


                        <!-- Create a div where the graph will take place -->
                         <div id='dashboard'>
                          <script>
                          function dashboard(id, fData){
                              var barColor = 'SkyBlue';
                              function segColor(c){ return {low:"##5F9EA0", mid:"#B0C4DE",high:"#4169E1"}[c]; }

                              // compute total for each state.
                              fData.forEach(function(d){d.total=d.freq.low+d.freq.mid+d.freq.high;});

                              // function to handle histogram.
                              function histoGram(fD){
                                  var hG={},    hGDim = {t: 20, r: 0, b: 30, l: 0};
                                  hGDim.w = 500 - hGDim.l - hGDim.r,
                                  hGDim.h = 300 - hGDim.t - hGDim.b;

                                  //create svg for histogram.
                                  var hGsvg = d3.select(id).append("svg")
                                      .attr("width", hGDim.w + hGDim.l + hGDim.r)
                                      .attr("height", hGDim.h + hGDim.t + hGDim.b).append("g")
                                      .attr("transform", "translate(" + hGDim.l + "," + hGDim.t + ")");

                                  // create function for x-axis mapping.
                                  var x = d3.scale.ordinal().rangeRoundBands([0, hGDim.w], 0.1)
                                          .domain(fD.map(function(d) { return d[0]; }));

                                  // Add x-axis to the histogram svg.
                                  hGsvg.append("g").attr("class", "x axis")
                                      .attr("transform", "translate(0," + hGDim.h + ")")
                                      .call(d3.svg.axis().scale(x).orient("bottom"));

                                  // Create function for y-axis map.
                                  var y = d3.scale.linear().range([hGDim.h, 0])
                                          .domain([0, d3.max(fD, function(d) { return d[1]; })]);

                                  // Create bars for histogram to contain rectangles and freq labels.
                                  var bars = hGsvg.selectAll(".bar").data(fD).enter()
                                          .append("g").attr("class", "bar");

                                  //create the rectangles.
                                  bars.append("rect")
                                      .attr("x", function(d) { return x(d[0]); })
                                      .attr("y", function(d) { return y(d[1]); })
                                      .attr("width", x.rangeBand())
                                      .attr("height", function(d) { return hGDim.h - y(d[1]); })
                                      .attr('fill',barColor)
                                      .on("mouseover",mouseover)// mouseover is defined below.
                                      .on("mouseout",mouseout);// mouseout is defined below.

                                  //Create the frequency labels above the rectangles.
                                  bars.append("text").text(function(d){ return d3.format(",")(d[1])})
                                      .attr("x", function(d) { return x(d[0])+x.rangeBand()/2; })
                                      .attr("y", function(d) { return y(d[1])-5; })
                                      .attr("text-anchor", "middle");

                                  function mouseover(d){  // utility function to be called on mouseover.
                                      // filter for selected state.
                                      var st = fData.filter(function(s){ return s.State == d[0];})[0],
                                          nD = d3.keys(st.freq).map(function(s){ return {type:s, freq:st.freq[s]};});

                                      // call update functions of pie-chart and legend.
                                      pC.update(nD);
                                      leg.update(nD);
                                  }

                                  function mouseout(d){    // utility function to be called on mouseout.
                                      // reset the pie-chart and legend.
                                      pC.update(tF);
                                      leg.update(tF);
                                  }

                                  // create function to update the bars. This will be used by pie-chart.
                                  hG.update = function(nD, color){
                                      // update the domain of the y-axis map to reflect change in frequencies.
                                      y.domain([0, d3.max(nD, function(d) { return d[1]; })]);

                                      // Attach the new data to the bars.
                                      var bars = hGsvg.selectAll(".bar").data(nD);

                                      // transition the height and color of rectangles.
                                      bars.select("rect").transition().duration(500)
                                          .attr("y", function(d) {return y(d[1]); })
                                          .attr("height", function(d) { return hGDim.h - y(d[1]); })
                                          .attr("fill", color);

                                      // transition the frequency labels location and change value.
                                      bars.select("text").transition().duration(500)
                                          .text(function(d){ return d3.format(",")(d[1])})
                                          .attr("y", function(d) {return y(d[1])-5; });
                                  }
                                  return hG;
                              }

                              // function to handle pieChart.
                              function pieChart(pD){
                                  var pC ={},    pieDim ={w:250, h: 250};
                                  pieDim.r = Math.min(pieDim.w, pieDim.h) / 2;

                                  // create svg for pie chart.
                                  var piesvg = d3.select(id).append("svg")
                                      .attr("width", pieDim.w).attr("height", pieDim.h).append("g")
                                      .attr("transform", "translate("+pieDim.w/2+","+pieDim.h/2+")");

                                  // create function to draw the arcs of the pie slices.
                                  var arc = d3.svg.arc().outerRadius(pieDim.r - 10).innerRadius(0);

                                  // create a function to compute the pie slice angles.
                                  var pie = d3.layout.pie().sort(null).value(function(d) { return d.freq; });

                                  // Draw the pie slices.
                                  piesvg.selectAll("path").data(pie(pD)).enter().append("path").attr("d", arc)
                                      .each(function(d) { this._current = d; })
                                      .style("fill", function(d) { return segColor(d.data.type); })
                                      .on("mouseover",mouseover).on("mouseout",mouseout);

                                  // create function to update pie-chart. This will be used by histogram.
                                  pC.update = function(nD){
                                      piesvg.selectAll("path").data(pie(nD)).transition().duration(500)
                                          .attrTween("d", arcTween);
                                  }
                                  // Utility function to be called on mouseover a pie slice.
                                  function mouseover(d){
                                      // call the update function of histogram with new data.
                                      hG.update(fData.map(function(v){
                                          return [v.State,v.freq[d.data.type]];}),segColor(d.data.type));
                                  }
                                  //Utility function to be called on mouseout a pie slice.
                                  function mouseout(d){
                                      // call the update function of histogram with all data.
                                      hG.update(fData.map(function(v){
                                          return [v.State,v.total];}), barColor);
                                  }
                                  // Animating the pie-slice requiring a custom function which specifies
                                  // how the intermediate paths should be drawn.
                                  function arcTween(a) {
                                      var i = d3.interpolate(this._current, a);
                                      this._current = i(0);
                                      return function(t) { return arc(i(t));    };
                                  }
                                  return pC;
                              }

                                // function to handle legend.
                                function legend(lD){
                                    var leg = {};

                                    // create table for legend.
                                    var legend = d3.select(id).append("table").attr('class','legend');

                                    // create one row per segment.
                                    var tr = legend.append("tbody").selectAll("tr").data(lD).enter().append("tr");

                                    // create the first column for each segment.
                                    tr.append("td").append("svg").attr("width", '16').attr("height", '16').append("rect")
                                        .attr("width", '16').attr("height", '16')
                                  .attr("fill",function(d){ return segColor(d.type); });

                                    // create the second column for each segment.
                                    tr.append("td").text(function(d){ return d.type;});

                                    // create the third column for each segment.
                                    tr.append("td").attr("class",'legendFreq')
                                        .text(function(d){ return d3.format(",")(d.freq);});

                                    // create the fourth column for each segment.
                                    tr.append("td").attr("class",'legendPerc')
                                        .text(function(d){ return getLegend(d,lD);});

                                    // Utility function to be used to update the legend.
                                    leg.update = function(nD){
                                        // update the data attached to the row elements.
                                        var l = legend.select("tbody").selectAll("tr").data(nD);

                                        // update the frequencies.
                                        l.select(".legendFreq").text(function(d){ return d3.format(",")(d.freq);});

                                        // update the percentage column.
                                        l.select(".legendPerc").text(function(d){ return getLegend(d,nD);});
                                    }

                                    function getLegend(d,aD){ // Utility function to compute percentage.
                                        return d3.format("%")(d.freq/d3.sum(aD.map(function(v){ return v.freq; })));
                                    }

                                    return leg;
                                }

                                // calculate total frequency by segment for all state.
                                var tF = ['low','mid','high'].map(function(d){
                                    return {type:d, freq: d3.sum(fData.map(function(t){ return t.freq[d];}))};
                                });

                                // calculate total frequency by state for all segment.
                                var sF = fData.map(function(d){return [d.State,d.total];});

                                var hG = histoGram(sF), // create the histogram.
                                    pC = pieChart(tF), // create the pie-chart.
                                    leg= legend(tF);  // create the legend.
                            }

                          </script>

                          <script>
                              var freqData=[
                                {State:'valle del cauca' ,freq:{low:1, mid: 14374,high:537999}}
                                ,{State:'caldas' ,freq:{low:1, mid: 14633,high:456915}}
                                ,{State:'antioquia' ,freq:{low:1, mid: 5781,high:404486}}
                                ,{State:'narino' ,freq:{low:1, mid: 7236,high:368636}}
                                ,{State:'magdalena' ,freq:{low:1, mid: 9545,high:296640}}
                                ,{State:'risaralda' ,freq:{low:1, mid: 10270,high:287100}}
                                ,{State:'cundinamarca' ,freq:{low:1, mid: 3716,high:275534}}
                                ,{State:'meta' ,freq:{low:1, mid: 9037,high:172173}}
                                ,{State:'tolima' ,freq:{low:1, mid: 7022,high:160914}}
                                ,{State:'putumayo' ,freq:{low:1, mid: 8125,high:120273}}
                              ];

                              dashboard('#dashboard',freqData);
                          </script>
                            <p style="color:rgb(54,51,255);">&nbsp;&nbsp;&nbsp;&nbsp;VC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PU</p>
                            <!--**************************-->
                            <hr>
                            <p > <strong>Acronimos,</strong>   (VC: Valle del Cauca), (CL: Caldas), (AN: Antioquia), (NR: Narino), (MG: Magdalena), (RI: Risaralda) ,(CU: Cundinamarca), (ME: Meta), (TO: Tolima) ,(PU: Putumayo). </p>

                            <hr>
                            <div class="chart">
                            <div id="chart"></div>
                            <div class="chart-footer">
                              <strong></strong> Visualizacion basada en modismo DashBoard: interaction between Bar Char and pie chart by Pasha’s Block.
                              <br>
                              <strong>By:</strong> Juan Fernando Zuluaga Ramirez
                              <br>
                              <strong>Source:</strong> <a href="https://raw.githubusercontent.com/juanfer960/DatosVizTarea3/master/json.txt">github</a>
                            </div>
                          </div>`
                            <!--************************-->

                        </div>
                        </div>

                      </div>



                      </div>

          <footer class="sticky-footer bg-white">
            <div class="container my-auto">
                <div class="copyright text-center my-auto">
                  <span>Copyright &copy; Biodiversidad en cifras (EL SIB) 2019</span>
                </div>
            </div>
          </footer>
        </div>
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>
  <!-- Bootstrap core JavaScript-->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="js/sb-admin-2.min.js"></script>

  <!-- Page level plugins -->
  <script src="vendor/chart.js/Chart.min.js"></script>

  <!-- Page level custom scripts -->
  <script src="js/demo/chart-area-demo.js"></script>
  <script src="js/demo/chart-pie-demo.js"></script>

</body>

</html>
